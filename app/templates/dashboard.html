{% extends "base.html" %}
{% block content %}
<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- å·¦ä¾§ï¼šå…¨å±€è®¾ç½® -->
    <div class="md:col-span-1">
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title">âš™ï¸ å…¨å±€é…ç½®</h2>
                <form action="/settings/save" method="post" class="form-control gap-2">
                    <label class="label"><span class="label-text">SMTP æœåŠ¡å™¨</span></label>
                    <input type="text" name="smtp_server" value="{{ settings.smtp_server }}" class="input input-bordered input-sm" />
                    
                    <label class="label"><span class="label-text">ç«¯å£ (SSL)</span></label>
                    <input type="number" name="smtp_port" value="{{ settings.smtp_port }}" class="input input-bordered input-sm" />
                    
                    <label class="label"><span class="label-text">å‘ä»¶é‚®ç®±</span></label>
                    <input type="text" name="smtp_user" value="{{ settings.smtp_user }}" class="input input-bordered input-sm" />
                    
                    <label class="label"><span class="label-text">æˆæƒç /å¯†ç </span></label>
                    <input type="password" name="smtp_password" value="{{ settings.smtp_password }}" class="input input-bordered input-sm" />
                    
                    <label class="label"><span class="label-text">é¢æ¿ç™»å½•å¯†ç </span></label>
                    <input type="password" name="admin_password" value="{{ settings.admin_password }}" class="input input-bordered input-sm" />
                    
                    <button class="btn btn-primary mt-4">ä¿å­˜è®¾ç½®</button>
                </form>
            </div>
        </div>
        
        <div class="card bg-base-100 shadow-xl mt-6">
            <div class="card-body">
                <h2 class="card-title">â• æ–°å»ºä»»åŠ¡</h2>
                <form action="/task/add" method="post" class="form-control gap-2">
                    <input type="text" name="name" placeholder="ä»»åŠ¡åç§° (å¦‚: Vaultwarden)" class="input input-bordered input-sm" required />
                    <input type="text" name="path" placeholder="å®¹å™¨è·¯å¾„ (å¦‚: /data/vaultwarden)" class="input input-bordered input-sm" required />
                    <input type="text" name="cron" placeholder="Cronè¡¨è¾¾å¼ (å¦‚: 0 4 * * *)" class="input input-bordered input-sm" required />
                    <input type="text" name="subject" placeholder="é‚®ä»¶æ ‡é¢˜å¤‡æ³¨" class="input input-bordered input-sm" required />
                    <input type="text" name="to_email" placeholder="æ¥æ”¶é‚®ç®± (ç•™ç©ºåŒå‘ä»¶äºº)" class="input input-bordered input-sm" />
                    <input type="text" name="zip_password" placeholder="å‹ç¼©å¯†ç  (å¯é€‰)" class="input input-bordered input-sm" />
                    <button class="btn btn-success mt-4">æ·»åŠ ä»»åŠ¡</button>
                </form>
            </div>
        </div>
    </div>

    <!-- å³ä¾§ï¼šä»»åŠ¡åˆ—è¡¨ -->
    <div class="md:col-span-2">
        <h2 class="text-2xl font-bold mb-4">ğŸ“¦ å¤‡ä»½ä»»åŠ¡åˆ—è¡¨</h2>
        <div class="grid grid-cols-1 gap-4">
            {% for task in tasks %}
            <div class="card bg-base-100 shadow-xl border-l-4 border-accent">
                <div class="card-body">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="card-title">{{ task.name }}</h3>
                            <p class="text-sm opacity-70">{{ task.path }}</p>
                            <div class="badge badge-outline mt-2">{{ task.cron }}</div>
                            <div class="badge badge-ghost mt-2">ä¸Šæ¬¡: {{ task.last_run }}</div>
                        </div>
                        <div class="flex flex-col gap-2">
                            <span class="badge {% if task.status == 'æˆåŠŸ' %}badge-success{% elif task.status == 'å¾…æœº' %}badge-ghost{% else %}badge-error{% endif %}">
                                {{ task.status }}
                            </span>
                            <a href="/task/run/{{ task.id }}" class="btn btn-sm btn-info">ğŸš€ ç«‹å³è¿è¡Œ</a>
                            <a href="/task/delete/{{ task.id }}" class="btn btn-sm btn-error" onclick="return confirm('ç¡®å®šåˆ é™¤å—ï¼Ÿ')">ğŸ—‘ï¸</a>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="alert">ç›®å‰è¿˜æ²¡æœ‰å¤‡ä»½ä»»åŠ¡ï¼Œè¯·åœ¨å·¦ä¾§æ·»åŠ ã€‚</div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
